import React, { useState, useEffect } from 'react';
import {
  ChevronDown, ChevronUp, CheckCircle2, XCircle, SkipForward, ArrowLeft, ArrowRight, Flag, RefreshCw, Play, Pause
} from 'lucide-react';

// The question pool has been moved inside the component for simplicity
const questionsPool = [
  // --- Domain 1.0: General Security Concepts ---
  {
    id: 'q1-1',
    domain: '1.0 General Security Concepts',
    question: "What is the primary purpose of a compensating control?",
    options: ["To prevent an incident from occurring.", "To recover from an incident.", "To provide an alternative to a primary control that is not feasible.", "To deter potential attackers."],
    correctAnswers: ["To provide an alternative to a primary control that is not feasible."],
    difficulty: "Easy",
    hint: "Think about a situation where you can't implement the ideal security measure. What do you do instead?"
  },
  {
    id: 'q1-2',
    domain: '1.0 General Security Concepts',
    question: "Which of the following describes the 'Integrity' principle of the CIA triad?",
    options: ["Ensuring data is accessible to authorized users when needed.", "Ensuring data is not altered or destroyed in an unauthorized manner.", "Ensuring data is not disclosed to unauthorized individuals.", "Ensuring that the organization can recover from a disaster."],
    correctAnswers: ["Ensuring data is not altered or destroyed in an unauthorized manner."],
    difficulty: "Easy",
    hint: "The 'I' in CIA stands for integrity."
  },
  {
    id: 'q1-3',
    domain: '1.0 General Security Concepts',
    question: "A security analyst is investigating a phishing attack. The goal is to determine the source of the attack without the attacker knowing they have been detected. Which of the following describes this type of security objective?",
    options: ["Deterrence", "Prevention", "Detection", "Obfuscation"],
    correctAnswers: ["Detection"],
    difficulty: "Medium",
    hint: "The question focuses on discovering an event without the attacker's knowledge."
  },
  {
    id: 'q1-4',
    domain: '1.0 General Security Concepts',
    question: "What is the primary purpose of a security policy?",
    options: ["To define the rules and standards for system configuration.", "To provide a high-level statement of management's intent.", "To specify technical controls for network devices.", "To outline procedures for responding to security incidents."],
    correctAnswers: ["To provide a high-level statement of management's intent."],
    difficulty: "Medium",
    hint: "A policy is a high-level document, while standards, baselines, and procedures are more granular."
  },
  {
    id: 'q1-5',
    domain: '1.0 General Security Concepts',
    question: "Which of the following is an example of a technical control?",
    options: ["Security awareness training", "Physical access control", "Intrusion Detection System (IDS)", "Biometric door lock"],
    correctAnswers: ["Intrusion Detection System (IDS)"],
    difficulty: "Easy",
    hint: "Technical controls are implemented with technology."
  },
  // --- Domain 2.0: Threats, Vulnerabilities, and Mitigations ---
  {
    id: 'q2-1',
    domain: '2.0 Threats, Vulnerabilities, and Mitigations',
    question: "An attacker sends an email that appears to be from a legitimate company, asking the recipient to click a link to verify their account information. This is an example of what type of attack?",
    options: ["Phishing", "Vishing", "Smishing", "Spear Phishing"],
    correctAnswers: ["Phishing"],
    difficulty: "Easy",
    hint: "This is a general term for fraudulent attempts to obtain sensitive information via email."
  },
  {
    id: 'q2-2',
    domain: '2.0 Threats, Vulnerabilities, and Mitigations',
    question: "Which of the following is a key characteristic of a zero-day exploit?",
    options: ["It is a vulnerability that has been publicly disclosed and patched.", "It is a vulnerability that has been discovered but no patch is available.", "It is a vulnerability that is only exploited by nation-state actors.", "It is a vulnerability that affects a new software version."],
    correctAnswers: ["It is a vulnerability that has been discovered but no patch is available."],
    difficulty: "Medium",
    hint: "Think about the timeline. 'Zero-day' refers to the time a vendor has to fix it."
  },
  {
    id: 'q2-3',
    domain: '2.0 Threats, Vulnerabilities, and Mitigations',
    question: "What is the primary goal of a Denial-of-Service (DoS) attack?",
    options: ["To steal sensitive data.", "To alter data on a server.", "To make a service unavailable to its intended users.", "To gain unauthorized access to a network."],
    correctAnswers: ["To make a service unavailable to its intended users."],
    difficulty: "Easy",
    hint: "The name of the attack gives it away."
  },
  {
    id: 'q2-4',
    domain: '2.0 Threats, Vulnerabilities, and Mitigations',
    question: "A user receives a text message urging them to click a link to win a prize. This is an example of what type of attack?",
    options: ["Phishing", "Vishing", "Smishing", "Spam"],
    correctAnswers: ["Smishing"],
    difficulty: "Easy",
    hint: "Think about the medium of communication. 'SMS' is key."
  },
  {
    id: 'q2-5',
    domain: '2.0 Threats, Vulnerabilities, and Mitigations',
    question: "Which of the following is a common mitigation for a man-in-the-middle attack?",
    options: ["Implementing a strong firewall.", "Using HTTPS with a valid SSL/TLS certificate.", "Configuring a WAF (Web Application Firewall).", "Regularly updating antivirus software."],
    correctAnswers: ["Using HTTPS with a valid SSL/TLS certificate."],
    difficulty: "Medium",
    hint: "A man-in-the-middle attack involves intercepting communication. What technology encrypts this communication?"
  },
  // --- Domain 3.0: Architecture and Design ---
  {
    id: 'q3-1',
    domain: '3.0 Architecture and Design',
    question: "What is the primary benefit of network segmentation?",
    options: ["To increase network speed.", "To reduce the cost of network hardware.", "To contain a security breach and limit its impact.", "To simplify network management."],
    correctAnswers: ["To contain a security breach and limit its impact."],
    difficulty: "Medium",
    hint: "Think about how a firewall between network segments can stop an attack from spreading."
  },
  {
    id: 'q3-2',
    domain: '3.0 Architecture and Design',
    question: "Which of the following is an example of a secure boot process?",
    options: ["BIOS starts the operating system.", "UEFI verifies the digital signature of boot loaders and drivers.", "The user enters a password to boot the system.", "The system performs a full memory test."],
    correctAnswers: ["UEFI verifies the digital signature of boot loaders and drivers."],
    difficulty: "Hard",
    hint: "Secure boot uses a modern firmware interface to check the integrity of the boot chain."
  },
  {
    id: 'q3-3',
    domain: '3.0 Architecture and Design',
    question: "What is the purpose of a honey pot?",
    options: ["To protect a real server from attacks.", "To detect and deflect attacks by luring attackers to a decoy system.", "To analyze network traffic for anomalies.", "To encrypt data at rest on a server."],
    correctAnswers: ["To detect and deflect attacks by luring attackers to a decoy system."],
    difficulty: "Easy",
    hint: "It's a decoy."
  },
  {
    id: 'q3-4',
    domain: '3.0 Architecture and Design',
    question: "A company wants to ensure that a power outage does not disrupt its critical services. Which of the following would best address this concern?",
    options: ["An Uninterruptible Power Supply (UPS)", "A surge protector", "A RAID array", "A firewall"],
    correctAnswers: ["An Uninterruptible Power Supply (UPS)"],
    difficulty: "Easy",
    hint: "This device provides temporary power when the main power source fails."
  },
  {
    id: 'q3-5',
    domain: '3.0 Architecture and Design',
    question: "Which of the following is a secure way to connect to a remote server's command line interface?",
    options: ["Telnet", "SSH", "FTP", "HTTP"],
    correctAnswers: ["SSH"],
    difficulty: "Easy",
    hint: "This protocol provides a secure, encrypted connection."
  },
  // --- Domain 4.0: Identity and Access Management (IAM) ---
  {
    id: 'q4-1',
    domain: '4.0 Identity and Access Management (IAM)',
    question: "What is the principle of least privilege?",
    options: ["Giving all users the same level of access to resources.", "Granting users only the permissions necessary to perform their job.", "Allowing a user to access any resource they request.", "Granting users temporary elevated privileges."],
    correctAnswers: ["Granting users only the permissions necessary to perform their job."],
    difficulty: "Easy",
    hint: "It's about minimizing the privileges a user has."
  },
  {
    id: 'q4-2',
    domain: '4.0 Identity and Access Management (IAM)',
    question: "Which of the following is a benefit of using Multi-Factor Authentication (MFA)?",
    options: ["It simplifies the login process for users.", "It reduces the risk of password-only attacks.", "It eliminates the need for strong passwords.", "It makes it easier to recover lost passwords."],
    correctAnswers: ["It reduces the risk of password-only attacks."],
    difficulty: "Easy",
    hint: "MFA requires more than one factor for authentication, making it much harder for attackers."
  },
  {
    id: 'q4-3',
    domain: '4.0 Identity and Access Management (IAM)',
    question: "What is the purpose of a certificate authority (CA) in a Public Key Infrastructure (PKI)?",
    options: ["To store user passwords.", "To issue and manage digital certificates.", "To encrypt all network traffic.", "To act as a firewall."],
    correctAnswers: ["To issue and manage digital certificates."],
    difficulty: "Medium",
    hint: "The 'A' in CA stands for authority, and its primary job is to manage certificates."
  },
  {
    id: 'q4-4',
    domain: '4.0 Identity and Access Management (IAM)',
    question: "What is the function of a Security Assertion Markup Language (SAML) provider?",
    options: ["To manage user passwords.", "To provide a single sign-on (SSO) solution.", "To encrypt data at rest.", "To manage network access control lists."],
    correctAnswers: ["To provide a single sign-on (SSO) solution."],
    difficulty: "Hard",
    hint: "SAML is a protocol for exchanging authentication and authorization data between an identity provider and a service provider."
  },
  {
    id: 'q4-5',
    domain: '4.0 Identity and Access Management (IAM)',
    question: "What is the purpose of an access control list (ACL) on a router?",
    options: ["To filter network traffic based on rules.", "To provide a list of all connected devices.", "To prioritize network packets.", "To manage user accounts."],
    correctAnswers: ["To filter network traffic based on rules."],
    difficulty: "Easy",
    hint: "ACLs are used to permit or deny traffic based on criteria like source/destination IP and port."
  },
  // --- Domain 5.0: Cryptography and PKI ---
  {
    id: 'q5-1',
    domain: '5.0 Cryptography and PKI',
    question: "Which of the following is a symmetric encryption algorithm?",
    options: ["RSA", "Diffie-Hellman", "AES", "ECC"],
    correctAnswers: ["AES"],
    difficulty: "Easy",
    hint: "Symmetric algorithms use a single key for both encryption and decryption."
  },
  {
    id: 'q5-2',
    domain: '5.0 Cryptography and PKI',
    question: "What is the primary purpose of a digital signature?",
    options: ["To encrypt data.", "To verify the integrity and authenticity of a message.", "To speed up data transmission.", "To compress data."],
    correctAnswers: ["To verify the integrity and authenticity of a message."],
    difficulty: "Medium",
    hint: "It proves the sender's identity and that the message hasn't been tampered with."
  },
  {
    id: 'q5-3',
    domain: '5.0 Cryptography and PKI',
    question: "What is a key benefit of using asymmetric encryption?",
    options: ["It is faster than symmetric encryption.", "It is more secure than symmetric encryption.", "It eliminates the need to securely share a secret key.", "It uses a single key for both encryption and decryption."],
    correctAnswers: ["It eliminates the need to securely share a secret key."],
    difficulty: "Medium",
    hint: "Asymmetric encryption uses a public and private key pair."
  },
  {
    id: 'q5-4',
    domain: '5.0 Cryptography and PKI',
    question: "What is the purpose of a nonce in cryptography?",
    options: ["To provide a unique value for each session to prevent replay attacks.", "To act as a public key in an asymmetric algorithm.", "To encrypt the data payload of a message.", "To sign a digital certificate."],
    correctAnswers: ["To provide a unique value for each session to prevent replay attacks."],
    difficulty: "Hard",
    hint: "A nonce is a number used once."
  },
  {
    id: 'q5-5',
    domain: '5.0 Cryptography and PKI',
    question: "Which of the following is a hashing algorithm?",
    options: ["AES", "3DES", "SHA-256", "RSA"],
    correctAnswers: ["SHA-256"],
    difficulty: "Easy",
    hint: "Hashing algorithms produce a fixed-size string from an input."
  },
  // --- Domain 6.0: Cloud, Virtualization, and Emerging Technologies ---
  {
    id: 'q6-1',
    domain: '6.0 Cloud, Virtualization, and Emerging Technologies',
    question: "Which of the following is an example of a Platform as a Service (PaaS) offering?",
    options: ["Amazon S3", "Google Cloud Compute Engine", "Microsoft Azure App Service", "Salesforce CRM"],
    correctAnswers: ["Microsoft Azure App Service"],
    difficulty: "Hard",
    hint: "PaaS provides a platform for developers to build and deploy applications without managing the underlying infrastructure."
  },
  {
    id: 'q6-2',
    domain: '6.0 Cloud, Virtualization, and Emerging Technologies',
    question: "What is the primary security concern with virtualization?",
    options: ["The risk of a single hypervisor failure affecting multiple virtual machines.", "The increased cost of hardware.", "The inability to monitor network traffic.", "The lack of patching for virtual machines."],
    correctAnswers: ["The risk of a single hypervisor failure affecting multiple virtual machines."],
    difficulty: "Medium",
    hint: "The hypervisor is a single point of failure that can impact many guests."
  },
  {
    id: 'q6-3',
    domain: '6.0 Cloud, Virtualization, and Emerging Technologies',
    question: "A company wants to host an application in a public cloud, but maintain control over the operating system and application layer. Which cloud service model should they choose?",
    options: ["IaaS", "PaaS", "SaaS", "DaaS"],
    correctAnswers: ["IaaS"],
    difficulty: "Hard",
    hint: "IaaS gives you the infrastructure (servers, storage, networking) but you manage the OS and above."
  },
  {
    id: 'q6-4',
    domain: '6.0 Cloud, Virtualization, and Emerging Technologies',
    question: "What is the primary security benefit of using containers?",
    options: ["Containers are inherently more secure than virtual machines.", "Containers allow for easy portability of applications.", "Containers provide process isolation from the host and other containers.", "Containers reduce the need for security patches."],
    correctAnswers: ["Containers provide process isolation from the host and other containers."],
    difficulty: "Medium",
    hint: "Isolation is key to a container's security model."
  },
  {
    id: 'q6-5',
    domain: '6.0 Cloud, Virtualization, and Emerging Technologies',
    question: "Which of the following is a security concern related to the Internet of Things (IoT)?",
    options: ["The devices are too expensive.", "The devices are not interoperable.", "Many devices have weak default passwords and lack regular updates.", "The devices are too complex to manage."],
    correctAnswers: ["Many devices have weak default passwords and lack regular updates."],
    difficulty: "Easy",
    hint: "The sheer number of poorly secured devices is a major threat."
  },
  // --- Domain 7.0: Security Operations and Incident Response ---
  {
    id: 'q7-1',
    domain: '7.0 Security Operations and Incident Response',
    question: "What is the primary purpose of a SIEM (Security Information and Event Management) system?",
    options: ["To manage user identities.", "To correlate and analyze security events and logs.", "To prevent malware infections.", "To perform vulnerability scans."],
    correctAnswers: ["To correlate and analyze security events and logs."],
    difficulty: "Medium",
    hint: "SIEM systems are all about collecting and analyzing log data from many sources."
  },
  {
    id: 'q7-2',
    domain: '7.0 Security Operations and Incident Response',
    question: "What is the first step in the incident response process?",
    options: ["Containment", "Eradication", "Preparation", "Recovery"],
    correctAnswers: ["Preparation"],
    difficulty: "Easy",
    hint: "You need a plan and resources in place before an incident occurs."
  },
  {
    id: 'q7-3',
    domain: '7.0 Security Operations and Incident Response',
    question: "During an incident response, what is the purpose of 'containment'?",
    options: ["To remove the threat from the network.", "To prevent the incident from causing further damage.", "To restore services to normal operation.", "To document the entire incident response process."],
    correctAnswers: ["To prevent the incident from causing further damage."],
    difficulty: "Easy",
    hint: "You need to stop the bleeding before you can fix the problem."
  },
  {
    id: 'q7-4',
    domain: '7.0 Security Operations and Incident Response',
    question: "Which of the following is a type of reconnaissance tool used by attackers?",
    options: ["Nmap", "Wireshark", "Metasploit", "John the Ripper"],
    correctAnswers: ["Nmap"],
    difficulty: "Hard",
    hint: "This tool is used for network discovery and port scanning."
  },
  {
    id: 'q7-5',
    domain: '7.0 Security Operations and Incident Response',
    question: "What is the purpose of a forensic acquisition of a hard drive?",
    options: ["To create a logical copy of the data.", "To create a bit-for-bit, unalterable copy of the drive.", "To perform a quick scan for malware.", "To restore the drive to a previous state."],
    correctAnswers: ["To create a bit-for-bit, unalterable copy of the drive."],
    difficulty: "Medium",
    hint: "Forensics requires an exact copy to maintain the chain of custody."
  },
  // Add more questions for all domains to reach the pool of 200...
];

const shuffleArray = (array) => {
  let newArray = [...array];
  for (let i = newArray.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
  }
  return newArray;
};

const formatTime = (seconds) => {
  const minutes = Math.floor(seconds / 60);
  const remainingSeconds = seconds % 60;
  return `${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;
};

const App = () => {
  const [examStarted, setExamStarted] = useState(false);
  const [questions, setQuestions] = useState([]);
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [selectedAnswers, setSelectedAnswers] = useState({});
  const [showAnswer, setShowAnswer] = useState({});
  const [flaggedQuestions, setFlaggedQuestions] = useState({});
  const [timeLeft, setTimeLeft] = useState(75 * 60); // 75 minutes in seconds
  const [isPaused, setIsPaused] = useState(false);
  const [examFinished, setExamFinished] = useState(false);

  useEffect(() => {
    let timer;
    if (examStarted && !isPaused && timeLeft > 0) {
      timer = setInterval(() => {
        setTimeLeft(prevTime => prevTime - 1);
      }, 1000);
    } else if (timeLeft === 0 && examStarted) {
      setExamFinished(true);
    }
    return () => clearInterval(timer);
  }, [examStarted, isPaused, timeLeft]);

  const startNewExam = () => {
    // Select 100 random questions from the pool
    const shuffledQuestions = shuffleArray(questionsPool);
    setQuestions(shuffledQuestions.slice(0, 100));
    setCurrentQuestionIndex(0);
    setSelectedAnswers({});
    setShowAnswer({});
    setFlaggedQuestions({});
    setTimeLeft(75 * 60);
    setIsPaused(false);
    setExamStarted(true);
    setExamFinished(false);
  };

  const handleAnswerSelect = (questionId, option) => {
    setSelectedAnswers(prevAnswers => ({
      ...prevAnswers,
      [questionId]: option,
    }));
  };

  const handleNextQuestion = () => {
    if (currentQuestionIndex < questions.length - 1) {
      setCurrentQuestionIndex(prevIndex => prevIndex + 1);
    }
  };

  const handlePreviousQuestion = () => {
    if (currentQuestionIndex > 0) {
      setCurrentQuestionIndex(prevIndex => prevIndex - 1);
    }
  };

  const handleToggleFlag = (questionId) => {
    setFlaggedQuestions(prevFlags => ({
      ...prevFlags,
      [questionId]: !prevFlags[questionId],
    }));
  };

  const currentQuestion = questions[currentQuestionIndex];
  const selectedOption = selectedAnswers[currentQuestion?.id];

  const getButtonClass = (option) => {
    let baseClasses = "w-full p-4 text-left rounded-lg transition-colors duration-200 border-2";
    let colorClasses = "bg-gray-800 border-gray-700 hover:bg-gray-700";

    // Show answer logic
    if (showAnswer[currentQuestion.id]) {
      if (questions[currentQuestionIndex].correctAnswers.includes(option)) {
        colorClasses = "bg-green-700 border-green-500 text-white";
      } else if (selectedOption === option && !questions[currentQuestionIndex].correctAnswers.includes(option)) {
        colorClasses = "bg-red-700 border-red-500 text-white";
      }
    } else if (selectedOption === option) {
      colorClasses = "bg-blue-600 border-blue-400 text-white";
    }

    return `${baseClasses} ${colorClasses}`;
  };

  if (examFinished) {
    const totalQuestions = questions.length;
    let correctAnswers = 0;
    questions.forEach(q => {
      if (q.correctAnswers.includes(selectedAnswers[q.id])) {
        correctAnswers++;
      }
    });

    return (
      <div className="flex flex-col items-center justify-center min-h-screen bg-gray-900 text-gray-200 p-8 rounded-lg shadow-xl">
        <h1 className="text-4xl font-extrabold text-blue-400 mb-4 text-center">
          Exam Complete!
        </h1>
        <p className="text-xl mb-2">You answered {correctAnswers} out of {totalQuestions} questions correctly.</p>
        <p className="text-lg">Your score: {((correctAnswers / totalQuestions) * 100).toFixed(2)}%</p>
        <button
          onClick={startNewExam}
          className="mt-6 p-4 rounded-lg bg-blue-600 text-white text-xl font-bold hover:bg-blue-700 transition-colors duration-200"
        >
          Start New Exam
        </button>
      </div>
    );
  }

  if (!examStarted) {
    return (
      <div className="flex flex-col items-center justify-center min-h-screen bg-gray-900 text-gray-200 p-8 rounded-lg shadow-xl">
        <h1 className="text-4xl font-extrabold text-blue-400 mb-4 text-center">
          CompTIA Security+ SY0-701 Practice Exam
        </h1>
        <p className="text-lg text-center mb-6 max-w-md">
          This practice exam consists of 100 questions pulled from a pool of 200,
          covering all the key objectives for the SY0-701 certification. You will have 75 minutes to complete the test.
        </p>
        <button
          onClick={startNewExam}
          className="p-4 rounded-lg bg-green-600 text-white text-xl font-bold hover:bg-green-700 transition-colors duration-200"
        >
          Start Exam
        </button>
      </div>
    );
  }

  if (isPaused) {
    return (
      <div className="fixed inset-0 bg-gray-950 bg-opacity-90 backdrop-blur-sm flex flex-col items-center justify-center p-8 z-50">
        <div className="bg-gray-800 p-10 rounded-xl shadow-2xl text-center max-w-lg w-full">
          <h2 className="text-4xl font-bold text-red-400 mb-4">Exam Paused</h2>
          <p className="text-xl text-gray-300 mb-6">
            Your exam is currently paused. The timer has stopped.
          </p>
          <button
            onClick={() => setIsPaused(false)}
            className="p-4 rounded-lg bg-green-600 text-white text-xl font-bold hover:bg-green-700 transition-colors duration-200 flex items-center justify-center space-x-2 w-full"
          >
            <Play size={24} />
            <span>Resume Exam</span>
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="flex flex-col min-h-screen bg-gray-900 text-gray-200 p-4 sm:p-8 font-['Inter']">
      {/* Header */}
      <div className="flex flex-col md:flex-row justify-between items-center bg-gray-800 rounded-xl p-4 mb-4 shadow-lg">
        <div className="text-lg font-bold text-blue-400 mb-2 md:mb-0">
          CompTIA Security+ SY0-701 Practice Exam
        </div>
        <div className="flex items-center space-x-4">
          <div className="text-lg font-mono">
            Time Left: <span className="text-red-400">{formatTime(timeLeft)}</span>
          </div>
          <button
            onClick={() => setIsPaused(true)}
            className="p-2 rounded-lg bg-gray-700 text-white hover:bg-gray-600 transition-colors duration-200"
            title="Pause Exam"
          >
            <Pause size={20} />
          </button>
        </div>
      </div>

      {/* Main Content */}
      <div className="flex-1 grid grid-cols-1 md:grid-cols-4 gap-4">
        {/* Navigation Panel */}
        <div className="md:col-span-1 bg-gray-800 rounded-xl p-4 shadow-lg h-min md:sticky md:top-4">
          <h2 className="text-xl font-semibold mb-4 text-blue-400">Questions ({questions.length})</h2>
          <div className="grid grid-cols-5 sm:grid-cols-8 md:grid-cols-5 lg:grid-cols-6 gap-2">
            {questions.map((q, index) => (
              <button
                key={q.id}
                onClick={() => setCurrentQuestionIndex(index)}
                className={`p-2 rounded-lg text-sm font-bold transition-colors duration-200
                  ${index === currentQuestionIndex ? 'bg-blue-600 text-white' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'}
                  ${selectedAnswers[q.id] ? 'border-2 border-green-500' : ''}
                  ${flaggedQuestions[q.id] ? 'border-2 border-yellow-500' : ''}
                `}
              >
                {index + 1}
              </button>
            ))}
          </div>
          <div className="mt-6 flex flex-col space-y-2 text-sm text-gray-400">
            <div className="flex items-center space-x-2">
              <span className="w-4 h-4 rounded-full border-2 border-green-500 bg-gray-700"></span>
              <span>Answered</span>
            </div>
            <div className="flex items-center space-x-2">
              <span className="w-4 h-4 rounded-full border-2 border-yellow-500 bg-gray-700"></span>
              <span>Flagged</span>
            </div>
            <div className="flex items-center space-x-2">
              <span className="w-4 h-4 rounded-full border-2 border-transparent bg-gray-700"></span>
              <span>Unanswered</span>
            </div>
          </div>
        </div>

        {/* Question Panel */}
        <div className="md:col-span-3 bg-gray-800 rounded-xl p-6 shadow-lg flex flex-col">
          {currentQuestion && (
            <>
              <div className="text-sm text-gray-400 mb-2">
                Question {currentQuestionIndex + 1} of {questions.length} | Domain: {currentQuestion.domain}
              </div>
              <h2 className="text-2xl font-bold mb-6">{currentQuestion.question}</h2>

              {/* Options */}
              <div className="flex-1 space-y-3">
                {currentQuestion.options.map((option, index) => (
                  <button
                    key={index}
                    onClick={() => handleAnswerSelect(currentQuestion.id, option)}
                    className={getButtonClass(option)}
                  >
                    <span className="mr-4 text-blue-400 font-bold">{String.fromCharCode(65 + index)}.</span>
                    {option}
                    {showAnswer[currentQuestion.id] && questions[currentQuestionIndex].correctAnswers.includes(option) && (
                      <CheckCircle2 className="inline-block ml-2 text-green-400" />
                    )}
                    {showAnswer[currentQuestion.id] && selectedOption === option && !questions[currentQuestionIndex].correctAnswers.includes(option) && (
                      <XCircle className="inline-block ml-2 text-red-400" />
                    )}
                  </button>
                ))}
              </div>

              {/* Control Buttons */}
              <div className="mt-8 flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0 sm:space-x-4">
                <div className="flex space-x-4">
                  <button
                    onClick={() => setShowAnswer(prev => ({ ...prev, [currentQuestion.id]: !prev[currentQuestion.id] }))}
                    className="p-3 rounded-lg bg-purple-600 text-white hover:bg-purple-700 transition-colors duration-200 flex items-center space-x-2"
                  >
                    {showAnswer[currentQuestion.id] ? (
                      <><ChevronUp size={20} /> <span>Hide Answer</span></>
                    ) : (
                      <><ChevronDown size={20} /> <span>Show Answer</span></>
                    )}
                  </button>
                  <button
                    onClick={() => handleToggleFlag(currentQuestion.id)}
                    className={`p-3 rounded-lg flex items-center space-x-2 transition-colors duration-200
                      ${flaggedQuestions[currentQuestion.id] ? 'bg-yellow-500 text-gray-900 hover:bg-yellow-400' : 'bg-gray-700 text-white hover:bg-gray-600'}`}
                  >
                    <Flag size={20} />
                    <span>{flaggedQuestions[currentQuestion.id] ? 'Unflag' : 'Flag'}</span>
                  </button>
                </div>

                <div className="flex space-x-4">
                  <button
                    onClick={handlePreviousQuestion}
                    disabled={currentQuestionIndex === 0}
                    className="p-3 rounded-lg bg-gray-700 text-white hover:bg-gray-600 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                    <ArrowLeft size={20} />
                  </button>
                  <button
                    onClick={handleNextQuestion}
                    disabled={currentQuestionIndex === questions.length - 1}
                    className="p-3 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                    <ArrowRight size={20} />
                  </button>
                </div>
              </div>
            </>
          )}
        </div>
      </div>
    </div>
  );
};

export default App;
